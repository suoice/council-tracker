<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Council Nexus</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts: Plus Jakarta Sans (Modern, Geometric) -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            black: '#0f1419', // X/Twitter Black
                            gray: '#536471',
                            light: '#eff3f4',
                            accent: '#1d9bf0', // Staple Blue
                            success: '#00ba7c',
                            danger: '#f91880',
                            warn: '#ffd400'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #ffffff; }
        .sidebar-sticky { position: sticky; top: 0; height: 100vh; }
        
        /* Smooth Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #e5e7eb; border-radius: 20px; }

        /* Instagram-style Ring Animation */
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(29, 155, 240, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(29, 155, 240, 0); }
            100% { box-shadow: 0 0 0 0 rgba(29, 155, 240, 0); }
        }
        .animate-ring { animation: pulse-ring 2s infinite; }
    </style>
</head>
<body class="text-brand-black overflow-x-hidden">

    <div class="flex min-h-screen">

        <!-- 1. LEFT SIDEBAR (Desktop) -->
        <aside class="hidden lg:flex flex-col w-[275px] border-r border-gray-100 px-4 py-6 sidebar-sticky bg-white z-50">
            <!-- Logo -->
            <div class="px-4 mb-8">
                <div class="w-10 h-10 bg-brand-black text-white rounded-xl flex items-center justify-center text-xl font-bold mb-2">
                    CN
                </div>
                <h1 class="text-xl font-bold tracking-tight">Council Nexus</h1>
                <p class="text-xs text-brand-gray font-medium">Task OS v2.1</p>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 space-y-1">
                <a href="#" class="flex items-center gap-4 px-4 py-3 text-lg font-bold bg-brand-light rounded-full transition-colors">
                    <i data-lucide="layout-grid" class="w-6 h-6"></i> Dashboard
                </a>
                <a href="#" class="flex items-center gap-4 px-4 py-3 text-lg font-medium text-brand-gray hover:bg-gray-50 hover:text-brand-black rounded-full transition-colors">
                    <i data-lucide="users" class="w-6 h-6"></i> Executives
                </a>
                <a href="#" class="flex items-center gap-4 px-4 py-3 text-lg font-medium text-brand-gray hover:bg-gray-50 hover:text-brand-black rounded-full transition-colors">
                    <i data-lucide="file-text" class="w-6 h-6"></i> History Log
                </a>
            </nav>

            <!-- User Profile Snippet -->
            <div class="mt-auto px-4 py-4 border-t border-gray-100">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500">
                        GS
                    </div>
                    <div>
                        <p class="text-sm font-bold">Guest Viewer</p>
                        <p class="text-xs text-brand-gray">Read-Only Mode</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- 2. MAIN FEED (Center) -->
        <main class="flex-1 max-w-4xl w-full border-r border-gray-100 min-h-screen">
            
            <!-- Mobile Header -->
            <header class="lg:hidden sticky top-0 bg-white/80 backdrop-blur-md border-b border-gray-100 p-4 z-40 flex justify-between items-center">
                <div class="font-bold text-xl">Council Nexus</div>
                <div class="w-8 h-8 bg-brand-black text-white rounded-full flex items-center justify-center font-bold text-sm">CN</div>
            </header>

            <!-- Stats Row (Donezo Style) -->
            <div class="p-6 grid grid-cols-2 md:grid-cols-4 gap-4 border-b border-gray-100 bg-white">
                <div class="p-4 rounded-3xl bg-gray-50 border border-gray-100">
                    <div class="flex items-center gap-2 mb-2 text-brand-gray">
                        <i data-lucide="zap" class="w-4 h-4"></i>
                        <span class="text-xs font-bold uppercase">Active</span>
                    </div>
                    <div class="text-3xl font-extrabold" id="stat-active">--</div>
                </div>
                <div class="p-4 rounded-3xl bg-brand-danger/5 border border-brand-danger/10">
                    <div class="flex items-center gap-2 mb-2 text-brand-danger">
                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                        <span class="text-xs font-bold uppercase">Overdue</span>
                    </div>
                    <div class="text-3xl font-extrabold text-brand-danger" id="stat-overdue">--</div>
                </div>
                <div class="p-4 rounded-3xl bg-brand-warn/10 border border-brand-warn/20">
                    <div class="flex items-center gap-2 mb-2 text-yellow-700">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        <span class="text-xs font-bold uppercase">Urgent</span>
                    </div>
                    <div class="text-3xl font-extrabold text-yellow-700" id="stat-urgent">--</div>
                </div>
                <div class="p-4 rounded-3xl bg-brand-success/5 border border-brand-success/10">
                    <div class="flex items-center gap-2 mb-2 text-brand-success">
                        <i data-lucide="check-circle-2" class="w-4 h-4"></i>
                        <span class="text-xs font-bold uppercase">On Track</span>
                    </div>
                    <div class="text-3xl font-extrabold text-brand-success" id="stat-normal">--</div>
                </div>
            </div>

            <!-- "Stories" Row (Executives) -->
            <div class="px-6 py-6 border-b border-gray-100 overflow-x-auto no-scrollbar">
                <h2 class="text-lg font-extrabold mb-4 flex items-center gap-2">
                    Current Board
                    <span class="text-xs font-normal text-brand-gray px-2 py-1 bg-gray-100 rounded-full" id="exec-count">0</span>
                </h2>
                
                <div class="flex gap-4 min-w-max" id="executives-list">
                    <!-- Executives Injected Here -->
                    <div class="animate-pulse flex gap-4">
                        <div class="w-16 h-16 bg-gray-100 rounded-full"></div>
                        <div class="w-16 h-16 bg-gray-100 rounded-full"></div>
                        <div class="w-16 h-16 bg-gray-100 rounded-full"></div>
                    </div>
                </div>
            </div>

            <!-- Search & Filter -->
            <div class="sticky top-0 lg:static bg-white/90 backdrop-blur-sm z-30 px-6 py-3 border-b border-gray-100 flex gap-3 items-center">
                <div class="relative flex-1">
                    <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-400"></i>
                    <input type="text" id="searchInput" placeholder="Search tasks..." class="w-full bg-gray-100 rounded-full py-2 pl-10 pr-4 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-brand-accent/50">
                </div>
                <select id="filterStatus" class="bg-gray-100 rounded-full px-4 py-2 text-sm font-bold text-gray-600 focus:outline-none cursor-pointer">
                    <option value="all">All</option>
                    <option value="urgent">Urgent</option>
                    <option value="overdue">Overdue</option>
                </select>
                <div id="loader" class="hidden">
                    <i data-lucide="loader-2" class="w-5 h-5 animate-spin text-brand-accent"></i>
                </div>
            </div>

            <!-- Feed Content -->
            <div class="bg-gray-50 min-h-screen">
                <div id="feed-container" class="divide-y divide-gray-100">
                    <!-- Tasks Injected Here -->
                    <div class="p-12 text-center text-gray-400">
                        Waiting for data connection...
                    </div>
                </div>
            </div>
        </main>

        <!-- 3. RIGHT SIDEBAR (Details) - "What's Happening" Style -->
        <aside class="hidden xl:block w-[350px] p-6 sidebar-sticky bg-white overflow-y-auto">
            <div id="details-panel-empty" class="h-full flex flex-col items-center justify-center text-center text-gray-400">
                <div class="w-16 h-16 bg-gray-50 rounded-2xl flex items-center justify-center mb-4">
                    <i data-lucide="mouse-pointer-2" class="w-8 h-8 text-gray-300"></i>
                </div>
                <h3 class="font-bold text-gray-900">Select an item</h3>
                <p class="text-sm mt-2 max-w-[200px]">Click on an executive or a task to view full history and details.</p>
            </div>

            <div id="details-panel-content" class="hidden space-y-6">
                <!-- Header -->
                <div class="flex items-start justify-between">
                    <div class="flex items-center gap-3">
                        <div id="detail-avatar" class="w-12 h-12 rounded-xl bg-brand-black text-white flex items-center justify-center text-lg font-bold">--</div>
                        <div>
                            <h2 id="detail-title" class="text-lg font-extrabold leading-tight">--</h2>
                            <p id="detail-subtitle" class="text-sm text-brand-gray">--</p>
                        </div>
                    </div>
                    <span id="detail-badge" class="px-2 py-1 text-xs font-bold bg-gray-100 rounded">--</span>
                </div>

                <!-- Context Card -->
                <div class="bg-gray-50 rounded-2xl p-4 border border-gray-100 space-y-3">
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-brand-gray">Deadline</span>
                        <span id="detail-deadline" class="font-bold">--</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-brand-gray">Requested By</span>
                        <span id="detail-requester" class="font-medium">--</span>
                    </div>
                    <div id="detail-blocker-box" class="hidden mt-2 p-3 bg-red-50 text-red-700 text-xs rounded-xl border border-red-100 flex gap-2 items-start">
                        <i data-lucide="alert-triangle" class="w-4 h-4 shrink-0"></i>
                        <span id="detail-blocker">--</span>
                    </div>
                </div>

                <!-- History Timeline -->
                <div>
                    <h3 class="font-bold text-sm uppercase tracking-wider text-gray-400 mb-4">Activity Log</h3>
                    <div id="history-list" class="space-y-0 relative">
                        <!-- History Items Injected -->
                    </div>
                </div>
            </div>
        </aside>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // *** CONFIGURATION ***
        const API_URL = 'PASTE_YOUR_NEW_WEB_APP_URL_HERE'; 

        // State
        let db = { executives: [], tasks: [], history: [] };
        let selectedFilter = 'all';

        // Init
        window.addEventListener('load', async () => {
            lucide.createIcons();
            await fetchData();
        });

        async function fetchData() {
            const loader = document.getElementById('loader');
            loader.classList.remove('hidden');
            
            try {
                if (API_URL.includes('PASTE')) {
                    console.warn("Using Mock Data");
                    db = getMockData();
                } else {
                    const res = await fetch(API_URL);
                    db = await res.json();
                }
                
                renderStats();
                renderExecutives();
                renderFeed();
                
            } catch (e) {
                console.error(e);
                alert("Error loading data. See console.");
            } finally {
                loader.classList.add('hidden');
            }
        }

        // --- RENDERERS ---

        function renderStats() {
            document.getElementById('stat-active').textContent = db.tasks.length;
            document.getElementById('stat-overdue').textContent = db.tasks.filter(t => t.Status.toLowerCase() === 'overdue').length;
            document.getElementById('stat-urgent').textContent = db.tasks.filter(t => t.Status.toLowerCase() === 'urgent').length;
            document.getElementById('stat-normal').textContent = db.tasks.filter(t => t.Status.toLowerCase() === 'normal').length;
            document.getElementById('exec-count').textContent = db.executives.length;
        }

        function renderExecutives() {
            const container = document.getElementById('executives-list');
            container.innerHTML = '';

            db.executives.forEach(exec => {
                // Count active tasks for this exec
                const taskCount = db.tasks.filter(t => t.Current_Owner_ID == exec.Executive_ID).length;
                const hasUrgent = db.tasks.some(t => t.Current_Owner_ID == exec.Executive_ID && (t.Status === 'urgent' || t.Status === 'overdue'));
                
                const ringColor = hasUrgent ? 'border-brand-danger' : (taskCount > 0 ? 'border-brand-accent' : 'border-gray-200');
                const ringAnim = hasUrgent ? 'animate-ring' : '';

                const el = document.createElement('button');
                el.className = 'flex flex-col items-center gap-2 group min-w-[72px]';
                el.onclick = () => selectExecutive(exec);
                el.innerHTML = `
                    <div class="relative w-16 h-16 rounded-full p-[2px] border-2 ${ringColor} ${ringAnim} bg-white transition-transform group-hover:scale-105">
                        <div class="w-full h-full rounded-full bg-gray-100 flex items-center justify-center text-sm font-bold text-gray-600 border border-white">
                            ${exec.Image_Initials}
                        </div>
                        ${taskCount > 0 ? `
                        <div class="absolute bottom-0 right-0 w-5 h-5 bg-brand-black text-white text-[10px] font-bold flex items-center justify-center rounded-full border-2 border-white">
                            ${taskCount}
                        </div>` : ''}
                    </div>
                    <span class="text-[11px] font-medium text-gray-600 truncate w-full text-center group-hover:text-black">
                        ${exec.Name.split(' ')[0]}
                    </span>
                `;
                container.appendChild(el);
            });
        }

        function renderFeed(filterExecId = null) {
            const container = document.getElementById('feed-container');
            container.innerHTML = '';

            let filtered = db.tasks;
            
            // Filter by Executive Click
            if (filterExecId) {
                filtered = filtered.filter(t => t.Current_Owner_ID == filterExecId);
            }

            // Filter by Dropdown
            const search = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;

            filtered = filtered.filter(t => {
                const matchesSearch = t.Description.toLowerCase().includes(search) || t.Task_ID.toLowerCase().includes(search);
                const matchesStatus = statusFilter === 'all' || t.Status.toLowerCase() === statusFilter;
                return matchesSearch && matchesStatus;
            });

            if (filtered.length === 0) {
                container.innerHTML = `<div class="p-10 text-center text-gray-400">No tasks found.</div>`;
                return;
            }

            filtered.forEach(task => {
                const owner = db.executives.find(e => e.Executive_ID == task.Current_Owner_ID) || { Name: 'Unknown', Image_Initials: '??' };
                const isUrgent = task.Status.toLowerCase() !== 'normal';
                
                const el = document.createElement('div');
                el.className = 'p-6 bg-white hover:bg-gray-50 transition-colors cursor-pointer group border-b border-gray-100';
                el.onclick = () => selectTask(task, owner);
                
                el.innerHTML = `
                    <div class="flex gap-4">
                        <div class="shrink-0">
                            <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600">
                                ${owner.Image_Initials}
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-1">
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-gray-900">${owner.Name}</span>
                                    <span class="text-gray-500 text-sm">@${owner.Committee}</span>
                                    <span class="text-gray-300 text-xs">â€¢</span>
                                    <span class="text-xs text-gray-400 font-mono">${task.Task_ID}</span>
                                </div>
                                <span class="text-xs font-bold px-2 py-1 rounded-full ${getStatusStyle(task.Status)}">
                                    ${task.Status.toUpperCase()}
                                </span>
                            </div>
                            
                            <p class="text-gray-900 text-[15px] leading-snug mb-3">
                                ${task.Description}
                            </p>

                            <div class="flex items-center gap-4 text-xs text-gray-500">
                                <div class="flex items-center gap-1 ${isUrgent ? 'text-brand-danger font-bold' : ''}">
                                    <i data-lucide="calendar" class="w-3 h-3"></i>
                                    ${new Date(task.Deadline).toLocaleDateString()}
                                </div>
                                <div class="flex items-center gap-1">
                                    <i data-lucide="user-circle" class="w-3 h-3"></i>
                                    Req: ${task.Requested_By.split(' ')[0]}
                                </div>
                                ${task.Blockers && task.Blockers !== 'None' ? `
                                <div class="flex items-center gap-1 text-orange-600 font-medium">
                                    <i data-lucide="alert-triangle" class="w-3 h-3"></i>
                                    Blocked
                                </div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(el);
            });
            lucide.createIcons();
        }

        // --- INTERACTIONS ---

        function selectExecutive(exec) {
            renderFeed(exec.Executive_ID);
            
            // Populate Right Panel with Executive Info
            showDetails(true);
            document.getElementById('detail-title').textContent = exec.Name;
            document.getElementById('detail-subtitle').textContent = exec.Position;
            document.getElementById('detail-avatar').textContent = exec.Image_Initials;
            document.getElementById('detail-badge').textContent = exec.Committee;
            
            // Hide task-specific fields in context card for exec view
            document.getElementById('detail-deadline').parentElement.classList.add('hidden');
            document.getElementById('detail-requester').parentElement.classList.add('hidden');
            document.getElementById('detail-blocker-box').classList.add('hidden');
            
            // Show recent history for this person
            const history = db.history.filter(h => h.Owner_ID == exec.Executive_ID);
            renderHistoryLog(history);
        }

        function selectTask(task, owner) {
            showDetails(true);
            document.getElementById('detail-title').textContent = task.Task_ID;
            document.getElementById('detail-subtitle').textContent = task.Description;
            document.getElementById('detail-avatar').textContent = owner.Image_Initials;
            document.getElementById('detail-badge').textContent = task.Status;
            
            // Show task specific fields
            document.getElementById('detail-deadline').parentElement.classList.remove('hidden');
            document.getElementById('detail-deadline').textContent = new Date(task.Deadline).toLocaleDateString();
            document.getElementById('detail-requester').parentElement.classList.remove('hidden');
            document.getElementById('detail-requester').textContent = task.Requested_By;
            
            const blockerBox = document.getElementById('detail-blocker-box');
            if (task.Blockers && task.Blockers !== 'None') {
                blockerBox.classList.remove('hidden');
                document.getElementById('detail-blocker').textContent = task.Blockers;
            } else {
                blockerBox.classList.add('hidden');
            }

            // Show history for this specific task
            const history = db.history.filter(h => h.Task_ID == task.Task_ID);
            renderHistoryLog(history);
        }

        function renderHistoryLog(historyItems) {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            
            if (historyItems.length === 0) {
                list.innerHTML = '<div class="text-xs text-gray-400 italic">No history recorded.</div>';
                return;
            }

            // Sort by date desc
            historyItems.sort((a,b) => new Date(b.Date) - new Date(a.Date)).forEach((h, idx) => {
                const isLast = idx === historyItems.length - 1;
                const el = document.createElement('div');
                el.className = 'flex gap-3 pb-6 relative';
                el.innerHTML = `
                    ${!isLast ? '<div class="absolute left-[5px] top-2 bottom-0 w-[2px] bg-gray-100"></div>' : ''}
                    <div class="w-3 h-3 rounded-full bg-brand-accent shrink-0 mt-1.5 relative z-10 border-2 border-white ring-1 ring-gray-100"></div>
                    <div>
                        <p class="text-xs text-gray-400 font-mono mb-0.5">${new Date(h.Date).toLocaleDateString()}</p>
                        <p class="text-sm font-bold text-gray-900">${h.Action}</p>
                        <p class="text-xs text-gray-500 mt-1 bg-gray-50 p-2 rounded">${h.Notes || 'No notes'}</p>
                    </div>
                `;
                list.appendChild(el);
            });
        }

        function showDetails(show) {
            const empty = document.getElementById('details-panel-empty');
            const content = document.getElementById('details-panel-content');
            if (show) {
                empty.classList.add('hidden');
                content.classList.remove('hidden');
            } else {
                empty.classList.remove('hidden');
                content.classList.add('hidden');
            }
        }

        function getStatusStyle(status) {
            switch(status.toLowerCase()) {
                case 'overdue': return 'bg-brand-danger text-white';
                case 'urgent': return 'bg-brand-warn text-brand-black';
                default: return 'bg-brand-success text-white';
            }
        }

        function getMockData() {
            return {
                executives: [{ Executive_ID: 1, Name: 'Maria Santos', Position: 'Pres', Committee: 'Exec', Image_Initials: 'MS' }],
                tasks: [{ Task_ID: 'DEMO-01', Description: 'Demo Task - Please connect API', Current_Owner_ID: 1, Status: 'urgent', Deadline: '2025-01-01', Requested_By: 'System', Blockers: 'None' }],
                history: []
            };
        }

        // Listeners
        document.getElementById('searchInput').addEventListener('input', () => renderFeed());
        document.getElementById('filterStatus').addEventListener('change', () => renderFeed());

    </script>
</body>
</html>
